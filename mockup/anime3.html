<!DOCTYPE html>
<html><head>
<title>Shinsekai Yori - UAnidb</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script type="text/javascript" src="js/kickstart.js"></script> 	                               <!-- KICKSTART -->
<script type="text/javascript" src="js/jquery.autosize-min.js"></script> 
<script type="text/javascript" src="js/jquery.tokeninput.js"></script>
<link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.10.3.custom.min.css" media="all" />  
<script type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>  
<script type="text/javascript" src="js/ui.datepicker-uk.js"></script> 
<script type="text/javascript">anime_id=1;</script> 	
<link rel="stylesheet" type="text/css" href="css/kickstart.css" media="all" />                  <!-- KICKSTART -->
<link rel="stylesheet" type="text/css" href="css/style.css" media="all" />                      <!-- CUSTOM STYLES --> 
</head>
<body>
<div class="head-menu">
	<header class="head-div">
		<div class="col_2 head-text">
			<h1 id="uanidb-logo2"><a href="http://ashenwolf.github.io/uanidb-mockup/mockup/anime3.html">UAnidb</a></h1>	
		</div>
		<div class="col_6">
			<ul class="menu">
			<li><a href=""><i class="icon-home"></i> Сайт</a>
				<ul>
				<li><a href=""><i class="icon-book"></i> Весь каталог</a></li>
				<li><a href=""><i class="icon-plus-sign"></i> Нове аніме</a></li>
				<li><a href=""><i class="icon-thumbs-up"></i> Рейтинг</a></li>
				<li><a href=""><i class="icon-retweet"></i> Випадкове</a></li>
				</ul>
			</li>
			<li><a href=""><i class="icon-github-alt"></i> Аніме</a>
				<ul>
				<li><a href=""><i class="icon-plus-sign"></i> Додати нове</a></li>
				<li><a href="#" onclick="$('#anime-edit').trigger('click');"><i class="icon-edit"></i> Редагувати</a></li>
				<li class="divider"><a href=""><i class="icon-trash"></i> Вилучити</a></li>
				</ul>
			</li>
			<li><a href=""><i class="icon-user"></i> Юзер</a>
				<ul>
					<li><a href=""><i class="icon-cog"></i> Профіль</a></li>
					<li><a href=""><i class="icon-envelope-alt"></i> Інбокс</a></li>
					<li class="divider"><a href=""><i class="icon-signout"></i> Вихід</a></li>
				</ul>			
			</li>
			<li><a href=""><i class="icon-info-sign"></i> Допомога</a>
				<ul>
					<li><a href=""><i class="icon-comments-alt"></i> Підтримка</a></li>
					<li><a href=""><i class="icon-group"></i> Форум</a></li>
				</ul>			
			</li>
			</ul>		
		</div>
		<div class="col_3 head-search">
			<form action="search" method="get" accept-charset="utf-8">
				<button class="pull-right small"><i class="icon-search"></i> Знайти!</button>
				<input type="text" name="" value="" placeholder="Аніме, персонаж...">					
			</form>
		</div>
		<div class="col_1 pull-right head-signout">
			<a title="Вихід (і вхід) для юзера" href=""><i class="icon-signout"></i></a>		
		</div>
	</header>
</div>
<div style="width:944px; margin:-40px auto 30px auto;" class="notice warning">Деякі поля редаговні (зі збереженням)! (Тільки перейдіть магічною паличкою на базу хоча б раз, "Молодша сестра..." не з бази)<a href="#close" class="icon-remove"></a></div>
<div class="grid">
	<article class="col_12">		
		<div class="block-content clearfix">
			<div id="info-title"><h2><textarea data-anime-id="" name="" maxlength="64" rows="2" cols="50" title="Моя молодша сестра не настільки вже й гарненька" class="anime-title" readonly="">Моя молодша сестра не настільки вже й гарненька</textarea></h2></div><div id="info-edit" class="pull-right"><a title="Почати/закінчити редагування цього аніме" href="#" onclick="$('#anime-edit').trigger('click'); return false;"><i class="icon-large icon-edit"></i></a><a id="ANN_info" title="Заповнити поля інформацією з ANN" href="#"><i class="icon-large icon-magic pull-right"></i></a></div>
			<div class="col_4">
				<div id="main-image" class="gallery">
					<a href="images/anime-1.jpg" style="max-width: 100%;"><img src="images/anime-1-240.jpg" alt="Anime screenshot"></a>
				</div>
			</div>
			<div id="anime-info-box" class="col_8">
				<ul class="tabs left">
					<li><a href="#anime-info">Інформація</a></li>
					<li><a href="#anime-cast">Персонажі</a></li>
					<li><a href="#anime-production">Виробництво</a></li>
					<li><a href="#anime-subs">Українською</a></li>
					<li><a href="#anime-similar">Схоже аніме</a></li>
				</ul>

				<div id="anime-info" class="tab-content">
					<table>
						<tbody>
							<tr>
								<th title="Офіційна японська назва">Офіційна назва:</th>
								<td><input name="jap_name_kan_1" maxlength="68" title="" class="anime-info" readonly="" value="新世界より" /></td><td><span class="pull-right" style="line-height: 14px;"><img src="images/flags/jp.png" alt="jp"></span></td>
							</tr>
							<tr>
								<th title="Латинізована японська">Ромаджі:</th>
								<td title="" colspan="2"><input name="jap_name_rom_1" maxlength="68" title="" class="anime-info" readonly="" value="Shinsekai Yori" /></td>
							</tr>
							<tr>
								<th title="Офіційна англійська назва">Англійська назва:</th>
								<td><input name="eng_name_1" maxlength="68" title="" class="anime-info" readonly="" value="From the New World" /></td><td><span class="pull-right" style="line-height: 14px;"><img src="images/flags/gb.png" alt="gb"></span></td>
							</tr>
							<tr>
								<th title="Основна українська назва">Українська назва:</th>
								<td><input name="ukr_name_1" maxlength="68" title="" class="anime-info" readonly="" value="Моя молодша сестра не настільки вже й гарненька" /></td><td><span class="pull-right" style="line-height: 14px;"><img src="images/flags/ua.png" alt="ua"></span></td>
							</tr>
							<tr>
								<th title="Альтернативні назви через кому">Ще відоме як:</th>
								<td title="Вводіть альтернативні назви через кому" colspan="2"><input name="other_nazv" maxlength="68" title="Вводіть альтернативні назви через кому" class="anime-info dimmed" readonly="" value="Не додано" /></td>
							</tr>
							<tr>
								<th>Тип:</th>
								<td style="padding-right:0;"><select style="display:none;" id="select-type"><option value="0">Не обрано</option><option value="1">Серіал</option><option value="2">Кіно</option></select><input id="input-type" name="type_film_id" maxlength="68" title="" class="dimmed anime-info" readonly=""  style="width:250px" value="Не обрано" /><span class="pull-right"><em>Серій:</em></span></td><td><input maxlength="4" name="series_count" id="series_count" class="anime-info pull-right" style="width:32px;text-align:right;font-size:14px;" readonly="" value="25" /></td>
							</tr>
							<tr>
								<th>Жанри:</th>
								<td id="td-genres"><input id="anime-genres" name="" maxlength="68" title="" class="anime-info" readonly="" value="Пригоди, Фентезі, Драма" /></td><td><a title="Розширене додавання жанру" href="#add_genre" id="add-genre-lightbox" class="icon-plus lightbox pull-right"></a></td>
							</tr>
							<tr>
								<th>Дати виходу:</th>
								<td colspan="2"><em>з</em> <input style="margin-left:6px;width:100px;" name="" id="" maxlength="68" title="" class="datepicker anime-info" readonly="" value="29.09.2012" /> <em>до</em> <input style="margin-left:6px;width:100px;" name="" id="" maxlength="68" title="" class="datepicker anime-info" readonly="" value="29.09.2013" /></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div style="display: none;">
					<div style="width:465px;" class="col_12 column" id="add_genre">
						<div style="width:400px; margin:0 0 30px 0; padding-left:15px; display:none;" id="genre-notice" class="notice">Тут ви можете додати в базу новий Жанр, лише майте на увазі: цей жанр додасться до конкретного аніме тільки, коли ви вийдете з режиму  редагування цього аніме <a href="#close" class="icon-remove"></a></div>
						<label style="margin-top:5px;" for="ukr_name_genre"><strong>Жанр українською</strong>, <span style="color:orange;" >обов'язкове</span> <span class="right">Напр., "Шьоджьо :)"</span></label><br />
						<input maxlength="110" class="form-input" type="text" id="ukr_name_genre" name="" /><br />
					
						<label for="jap_kana_name_genre">Жанр японською <span class="right">Напр., "少女"</span></label><br />
						<input maxlength="110" class="form-input" type="text" id="jap_kana_name_genre" name="" /><br />				

						<label for="jap_rom_name_genre">Жанр англійською чи ромаджі <span class="right">Напр., "Shoujo"</span></label><br />
						<input maxlength="110" class="form-input" type="text" id="jap_rom_name_genre" name="" /><br />
						
						<label class="form-label">Опис: </label><br />
						<textarea maxlength="340" class="form-textarea" id="opys" name=""></textarea><br /><br />
						<button style="margin-bottom:10px;" id="genre-post" class="green"><i class="icon-plus-sign"></i> Додати жанр</button>
					</div>
				</div>
				<div id="anime-cast" class="tab-content">
					<table class="striped">
						<tbody>
							<tr>
								<th class="char">Asahina Satoru</th>
								<td class="creator"><a href="#">Toujou Kanako</a>, <a href="animedb.pl?show=creator&amp;creatorid=1678">Kaji Yuuki</a></td>
							</tr>
							<tr class="g_odd">
								<th class="creator">Watanabe Saki</th>
								<td class="char"><a href="#">Taneda Risa</a></td>
							</tr>
							<tr>
								<th class="creator">Akizuki Maria</th>
								<td class="char"><a href="#">Hanazawa Kana</a></td>
							</tr>
							<tr class="g_odd">
								<th class="char">Aonuma Shun</th>
								<td class="creator"><a href="#">Murase Ayumu</a>, <a href="animedb.pl?show=creator&amp;creatorid=4005">Toudou Mai</a></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="anime-production" class="tab-content">
					<table class="striped">
						<tbody>
							<tr>
								<th>Студія:</th>
								<td><a href="#" title="">A-1 Pictures</a></td>
							</tr>
							<tr>
								<th>Режисер:</th>
								<td><a href="#" title="">Ішіхама Масаші</a></td>
							</tr>
							<tr>
								<th>Автор оригіналу:</th>
								<td><a href="#" title="">Кіші Юусуке</a></td>
							</tr>
							<tr>
								<th class="credit">Series Composition:</th>
								<td class="creator"><a href="animedb.pl?show=creator&amp;creatorid=1411">Sogo Masashi</a></td>
							</tr>
							<tr>
								<th class="credit">Character Design:</th>
								<td class="creator"><a href="animedb.pl?show=creator&amp;creatorid=671">Kubota Chikashi</a></td>
							</tr>
							<tr>
								<th class="credit">Music:</th>
								<td class="creator"><a href="animedb.pl?show=creator&amp;creatorid=2422">Komori Shigeo</a></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="anime-subs" class="tab-content">
					<table class="striped">
						<tbody>
							<tr>
								<th rowspan="2">Субтитри</th>
								<td><i class="icon-file-alt"></i> <a href="#">UAnime</a></td>
							</tr>
							<tr>
								<td><i class="icon-file-alt"></i> <a href="#">І знову UAnime</a></td>
							</tr>
							<tr>
								<th>Озвучка/дубляж</th>
								<td>Нема даних</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="anime-similar" class="tab-content">
					<table class="striped">
						<tbody>
							<tr><td><i class="icon-ok"></i> <a href="#" title="">Psycho-Pass</a></td></tr>
							<tr><td><i class="icon-ok"></i> <a href="#" title="">No. 6</a></td></tr>
							<tr><td><i class="icon-ok"></i> <a href="#" title="">Shiki</a></td></tr>
						</tbody>
					</table>
				</div>
			</div>

			<div id="synopsis" class="col_12" contenteditable="false">				
				<p>Манга Paradise Kiss публікувалася в одному з популярних японських журналів моди. В аніме Paradise Kiss – назва бренду одягу, який розробляє група студентів школи мистецтв. А мова піде про досить посередню, хоча і гарну, ученицю старшої школи, якій не пощастило з ними зв'язатися. Чи, може, навпаки – пощастило?.</p>
				<p>Цей дуже короткий фільм фактично був анонсом до телевізійного серіалу Азуманґа Даіо. Вдала екранізація низки оповідань Рьоґо Наріти. Він містить кілька сцен, які надалі увійшли у серіал.</p>
				<p>Сакакібара Коічі переїжджає в містечко Йоміяма (Пекельна гора) до своїх дідуся і бабусі. Через хворобу, яка скосила його незабаром після приїзду, він пропускає місяць навчання і приходить до школи лишень в травні. Клас зустрічає його привітно, але в повітрі витає якась таємниця. Одну з його однокласниць, Місакі Мей, з якою він познайомився у лікарні, здається, ніхто окрім нього не помічає. Яка ж таємниця нависла над школою?</p>
			</div>			
			<div id="under-synopsis" class="col_12">
				<hr>
				<p>Щоб не забути: сюди ще мають піти: Проголосувати за це аніме! Поділитися на фейсбук! Це аніме на anidb! і т.п.</p>
				<hr>
			</div>			
			<div class="pull-right">
				<button id="anime-error" class="small"><i class="icon-exclamation-sign"></i> Повідомити про помилку</button>
				<button id="anime-edit" class="small"><i class="icon-edit"></i> Редагувати інформацію</button>
			</div>
		</div>
	</article>

	<!-- <div class="col_12">
		<div class="block-content clearfix">
		    <div id="disqus_thread"></div>
		    <script type="text/javascript">
		        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		        var disqus_shortname = 'uanidbmockup'; // required: replace example with your forum shortname

		        /* * * DON'T EDIT BELOW THIS LINE * * */
		        (function() {
		            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		        })();
		    </script>
		    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</div>
	</div>-->

</div><!-- END GRID-->
	
<!-- ===================================== START FOOTER ===================================== -->

<div class="foot-menu">
	<footer class="foot-div">
		<p class="pull-left">Sensetivity &copy; 2013</p>
		<p class="pull-right"><a href="#" title="">Про сайт</a> &nbsp; <a href="#" title="">Приватність</a> &nbsp; <a href="#" title="">Допомога</a></p>
	</footer>
</div>

<script type="text/javascript">
	$("#select-type").change(function() {
		$("#input-type").val($("#select-type").find(":selected").text());
		if($("#select-type").val()=='0') $("#input-type").addClass("dimmed");
		else $("#input-type").removeClass("dimmed");
		$("#input-type").trigger('input');
	});
	$(".anime-info[name='other_nazv']").on("focus", function() {
		if($(this).attr('readonly'))return;
		if($(this).val()=='Не додано'){
			$(this).val('');
			$(this).removeClass('dimmed');
		}
	});	
	$(".anime-info[name='other_nazv']").on("blur", function() {
		if($(this).attr('readonly'))return;
		if($(this).val()==''){
			$(this).val('Не додано');
			$(this).addClass('dimmed');			
		}
	});	
	$("#genre-post").on("click", function() {
		if(!$(".anime-title").attr('readonly') && $('#ukr_name_genre').val()){
			add_genres();
		}
	});
	$(document).on("click", ".token-input-token-facebook p", function() {
		alert("Перехід на "+$(this).text());
	});
	$(document).on("mouseenter", ".token-input-token-facebook", function() {
		$("p",this).css("text-decoration","underline");
		$("p",this).css('cursor', 'pointer');
	});	
	$(document).on("mouseleave", ".token-input-token-facebook", function() {
		$("p",this).css("text-decoration","none");
		$("p",this).css('cursor', 'auto');
	});	
	$(".anime-title").on("input", function() {
		$(".anime-title").attr("data-changed","1");
		$(".anime-info[name='ukr_name_1']").attr("data-changed","1");
	});	
	$(".anime-info").on("input", function() {
		$(this).attr("data-changed","1");
		if(!$(".anime-title").attr("data-changed")) $(".anime-title").attr("data-changed","1");
	});		
	$(".anime-info[name='ukr_name_1']").on("input", function() {
		$(".anime-title").attr("data-changed","1");
	});
	$(".anime-title").keyup(function() {
		$(".anime-info[name='ukr_name_1']").val($(this).val());
	});
	$(".anime-info[name='ukr_name_1']").keyup(function() {
		$(".anime-title").val($(this).val()).trigger('autosize');		
	});
	$("#synopsis").on("keyup", function() {
		if(!$(".anime-title").attr("data-changed")) $(".anime-title").attr("data-changed","1");
		if(!$("#synopsis").attr("data-changed")) $("#synopsis").attr("data-changed","1");
	});	
    $("#anime-edit").click(function (e) {
		if($(".anime-title").attr('readonly')){
			$("#select-type").show();
			$("#input-type").hide();			
			$(document).off('click', '.token-input-token-facebook p');
			$(document).off('mouseenter', '.token-input-token-facebook');
			$(document).off('mouseleave', '.token-input-token-facebook');
			$(".anime-title").attr('readonly', false);
			$(".anime-info").attr('readonly', false);
			$("#synopsis").attr('contenteditable', true);
			$('#anime-genres').tokenInput("toggleDisabled");			
			$(this).html( '<i class="icon-edit"></i> Закінчити редагування');
			$("#info-edit .icon-edit").css('color', 'rgb(238, 86, 15)');
			$(".block-content").css('-moz-box-shadow', '0 0 8px rgb(255, 144, 42)');
			$(".block-content").css('-webkit-box-shadow', '0 0 8px rgb(255, 144, 42)');			
			$(".block-content").css('box-shadow', '0 0 8px rgb(255, 144, 42)');
			$(".anime-title").addClass('info-focused');
			$(".anime-info").addClass('info-focused');
		}else{
			if($(".anime-title").attr('data-changed')){
				if($(".anime-title").attr('data-anime-id')){
					if(update_anime($(".anime-title").attr('data-anime-id'))){
						alert ("something is fucked!");
						return;
					}					
				}	
			}
			if($("#anime-genres").attr("data-changed") && $(".anime-title").attr('data-anime-id')) {				
				update_genres($(".anime-title").attr('data-anime-id'));												
			}
			$(document).on("click", ".token-input-token-facebook p", function() {
				alert("Перехід на "+$(this).text());
			});
			$(document).on("mouseenter", ".token-input-token-facebook", function() {
				$("p",this).css("text-decoration","underline");
				$("p",this).css('cursor', 'pointer');
			});	
			$(document).on("mouseleave", ".token-input-token-facebook", function() {
				$("p",this).css("text-decoration","none");
				$("p",this).css('cursor', 'auto');
			});				
			$("#select-type").hide();
			$("#input-type").show();	
			$('#anime-genres').tokenInput("toggleDisabled");
			$(".anime-title").attr('readonly', true);
			$(".anime-info").attr('readonly', true);
			$("#synopsis").attr('contenteditable', false);
			$(this).html( '<i class="icon-edit"></i> Редагувати інформацію');
			$("#info-edit .icon-edit").css('color', 'inherit');	
			$(".block-content").css('-moz-box-shadow', 'none');
			$(".block-content").css('-webkit-box-shadow', 'none');	
			$(".block-content").css('box-shadow', 'none');	
			$(".anime-title").removeClass('info-focused');
			$(".anime-info").removeClass('info-focused');			
		}
    });
	$("#ANN_info").click(function (e) {
		if($(".anime-title").attr('readonly')){			
			if(anime_id<10){
				get_anime(anime_id);
				//get_types(anime_id);
				get_anime_genres(anime_id++);
				return false;
			}else{
				get_anime(anime_id); 
				//get_types(anime_id);
				get_anime_genres(anime_id);
				anime_id=1; 
				return false;
			}
		}else return false;
	});	
	if ($.browser.msie && $.browser.version == 10) { 	<!-- ========= I'M FUCKING AT A LOSS HERE... =============== -->
		$(".anime-title").css("padding-bottom","10px");
		$(".anime-title").css("margin-top","0px");
	}		
	function get_anime(id){
		$.ajax({ 
			type: 'GET', 
			url: 'http://oilreview.x10.mx/anime.php', 
			data: { aid: id }, 
			dataType: 'json',
			beforeSend: function (){
				$('.notice').html('Працюю з базою...');
			},
			success: function (data) { 
				$(".anime-title").attr('data-anime-id', data.anime_id);
				$(".anime-title").val(data.ukr_name_1).trigger('autosize');
				$(".anime-info[name='jap_name_rom_1']").attr('value', data.jap_name_rom_1);
				$(".anime-info[name='eng_name_1']").attr('value', data.eng_name_1);
				$(".anime-info[name='jap_name_kan_1']").attr('value', data.jap_name_kan_1);
				$(".anime-info[name='ukr_name_1']").attr('value', data.ukr_name_1);
				$("#select-type").val(data.type_film_id);
				$("#input-type").val($("#select-type option:selected").text());
				if(data.type_film_id=='0') $("#input-type").addClass("dimmed");
				else $("#input-type").removeClass("dimmed");
				$("#series_count").val(data.series_count);
				$("#synopsis").html(data.sinopsis);
				$('.notice').html('Все ок!');
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(textStatus, errorThrown);
			}
		});
	}

	function update_anime(id){
		var myData={};
		myData['anime_id']=id;
		$('.anime-info').each(function(i, obj) {
			if($(this).attr("name") && $(this).attr("data-changed")){
				if($(this).attr('id')=='input-type') myData[$(this).attr("name")]=$('#select-type').val();
				else myData[$(this).attr("name")]=$(this).val().replace(/'/g,"\\'");
				$(this).removeAttr("data-changed");
			}
		});	
		if($("#synopsis").attr("data-changed")){
			myData['sinopsis']=$("#synopsis").html().replace(/'/g,"\\'");
		}
		$.ajax({ 
			type: 'POST', 
			crossDomain:true,
			url: 'http://oilreview.x10.mx/anime.php', 
			data: {anime_update:JSON.stringify(myData)}, 
			dataType: 'json',
			beforeSend: function (){
				$('.notice').html('Працюю з базою...');
			},
			success: function (data) {
				$('.anime-info').each(function(i, obj) {	
					if($(this).attr("name") && $(this).attr("data-changed")){
						$(this).removeAttr("data-changed");
					}					
				});
				if($("#synopsis").attr("data-changed"))$("#synopsis").removeAttr("data-changed");
				$(".anime-title").removeAttr("data-changed").trigger('autosize');
				if (data=="0")$('.notice').html('Всі зміни записано!');
				else $('.notice').html(data);
				return 0;
			},
			error: function(jqXHR, textStatus, errorThrown){
				$('.notice').html(jqXHR+' | '+textStatus+' | '+errorThrown);
				return 1;
			}
		});
	}

	function get_anime_genres(id){		
		$.ajax({ 
			type: 'GET', 
			url: 'http://oilreview.x10.mx/genres.php', 
			data: { aid: id }, 
			dataType: 'json',
			beforeSend: function (){
				$('.notice').html('Працюю з базою...');
			},
			success: function (data) { 
				//genres_all=[];
				genres_populate=[];
				genres_populate=data;
				/*for (var i = 0; i < data.length; i++) {
					if(data[i].flag==1){
						genres_populate.push(data[i]);
						//genres_all.push(data[i]);
					}
					//else genres_all.push(data[i]);
				}*/
				$('#anime-genres').tokenInput('destroy');
				init_genres();
				$('.notice').html('Все ок!');
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(textStatus, errorThrown);
			}
		});
	}
	
	function update_genres(id){
		var myData={};
		myData['anime_id']=id;
		var genres=$('#anime-genres').tokenInput("get");
		for(var i=0;i<genres.length;i++){
			myData[genres[i].id]=genres[i].name;
		}
		$.ajax({ 
			type: 'POST', 
			crossDomain:true,
			url: 'http://oilreview.x10.mx/genres.php', 
			data: {genres_update:JSON.stringify(myData)}, 
			dataType: 'json',
			beforeSend: function (){
				$('.notice').html('Працюю з базою...');
			},
			success: function (data) {	
				$("#anime-genres").removeAttr("data-changed");
				if (data=="0")$('.notice').html('Всі зміни записано!');
				else $('.notice').html(data);
				return 0;
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(jqXHR);
				alert(textStatus);
				alert(errorThrown);
				return 1;
			}
		});
	}
	
	function add_genres(){
		var myData={};
		//myData['anime_id']=id;
		myData['ukr_name_genre']=$('#ukr_name_genre').val();
		myData['jap_rom_name_genre']=$('#jap_rom_name_genre').val();
		myData['jap_kana_name_genre']=$('#jap_kana_name_genre').val();
		myData['opys']=$('#opys').val();
		$.ajax({ 
			type: 'POST', 
			crossDomain:true,
			url: 'http://oilreview.x10.mx/genres.php', 
			data: {genres_add:JSON.stringify(myData)}, 
			dataType: 'json',
			beforeSend: function (){
				$('#genre-notice').html('Працюю з базою...' + '<a href="#close" class="icon-remove"></a>');
				$('#genre-notice').show();
			},
			success: function (data) {	
				if (!isNaN(parseInt(data))){
					$('#genre-notice').addClass('success');
					$('#genre-notice').html('Жанр додано!'+'<a href="#close" class="icon-remove"></a>');
					$('#anime-genres').tokenInput("add", {id: data, name: $('#ukr_name_genre').val()});
					$('#token-input-anime-genres').css('width','20px');
					$.fancybox.close();			
					$('#token-input-anime-genres').focus();
					return true;
				}
				else{
					$('#genre-notice').removeClass('success');
					$('#genre-notice').html(data+'<a href="#close" class="icon-remove"></a>');
					return false;
				}
			},
			error: function(jqXHR, textStatus, errorThrown){
				$('#genre-notice').removeClass('success');
				$('#genre-notice').html(jqXHR+' | '+textStatus+' | '+errorThrown+'<a href="#close" class="icon-remove"></a>');
				return false;
			}
		});
	}
	
	function get_types(id){		
		$.ajax({ 
			type: 'GET', 
			url: 'http://oilreview.x10.mx/type.php', 
			data: { aid: id }, 
			dataType: 'json',
			beforeSend: function (){
				$('.notice').html('Працюю з базою...');
			},
			success: function (data) { 
				$("#select-type").val('');
				$("#select-type").empty();	
				$("#select-type").append($("<option />").val(0).text("Не обрано"));
				$.each(data, function() {
					$("#select-type").append($("<option />").val(this.tid).text(this.name));
				});
				$('.notice').html('Все ок!');
			},
			error: function(jqXHR, textStatus, errorThrown){
				alert(textStatus, errorThrown);
			}
		});
	}

	$("#anime-error").click(function (e) {
		alert(JSON.stringify($('#anime-genres').tokenInput("get")));
	});
	
	var genres_all=[];
	var genres_populate=[];
	
	function init_genres(){
		$('#anime-genres').tokenInput("http://oilreview.x10.mx/genres.php", {
                prePopulate: genres_populate,
				preventDuplicates: true,
				tokenLimit: 10,
				minChars: 2,
				crossDomain: false,
                theme: "facebook",
				hintText: "Текст+Пошук існуючих або Текст+Enter: додати новий",
				searchingText: "Шукаю...",
				noResultsText: "Не знайдено",
				disabled: true,
				searchDelay: 100,
				onAdd: genres_change,
				onDelete: genres_change,
				allowFreeTagging: true
        });		
		if($("#anime-genres").attr("data-changed"))$("#anime-genres").removeAttr("data-changed");
	}
	
	function genres_change(){
		if(!$("#anime-genres").attr("data-changed")) {
			$("#anime-genres").attr("data-changed","1");
		}
	}
	
	function text_area_height_opera(){	<!-- ========= I'M FUCKING AT A LOSS HERE... =============== -->
		if ($.browser.opera){
			var txt=$(".anime-title");
			//txt.scrollTop(txt[0].scrollHeight - txt.height());
			txt.height( txt[0].scrollHeight);
			txt.css("margin-top","0px");
		}
	}
	
	function fancyboxLoad(){
		if($(".anime-title").attr('readonly')){			
			return false;
		}else{	
			$('#genre-notice').removeClass('success');
			$('#genre-notice').hide();
			$('#ukr_name_genre').val('');
			$('#jap_rom_name_genre').val('');
			$('#jap_kana_name_genre').val('');
			$('#opys').val('');
			$('#fancybox-wrap div').css('left', parseInt(($(window).width() / 2) - ($('#fancybox-wrap').width() / 2), 10));
			return true;
		}		
	}
	
	$( document ).ready(function() {
		$('.anime-title').autosize();
		text_area_height_opera();	
		init_genres();
		$('.lightbox').fancybox({
			onStart: fancyboxLoad,
			scrolling: 'no',
			//width: 475,
			//height: 650,
			//autoDimensions: false,
			padding:30
		});
		get_types(anime_id);
		$('.datepicker').datepicker({
			dateFormat: "dd.mm.yy",
			changeMonth: true,
			changeYear: true,
			yearRange: "1950:"
		});
	});	
</script>

</body></html>
